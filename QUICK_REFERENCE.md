# MindLab Health - Hostinger Deployment Quick Reference
# ======================================================

## Files Created

1. **.env** - Production environment configuration (LOCAL ONLY - NOT in Git)
2. **requirements.txt** - Updated with pinned versions for Ubuntu
3. **DEPLOYMENT_HOSTINGER.md** - Complete deployment guide
4. **deploy_hostinger.sh** - Automated deployment script

## Quick Deployment Steps

### Option 1: Automated Deployment (Recommended)

```bash
# 1. SSH into your Hostinger VPS
ssh root@your-vps-ip

# 2. Download deployment script
wget https://raw.githubusercontent.com/onefsmedia/mindlab-health-v2/master/deploy_hostinger.sh

# 3. Make executable
chmod +x deploy_hostinger.sh

# 4. Run deployment
sudo ./deploy_hostinger.sh

# 5. Follow prompts for:
#    - Database password
#    - GitHub repository URL
#    - Domain name
```

### Option 2: Manual Deployment

Follow the detailed guide in `DEPLOYMENT_HOSTINGER.md`

## Post-Deployment Configuration

### 1. Update .env File

```bash
sudo nano /var/www/mindlab-health/app/.env
```

**Critical settings to update:**
- `DATABASE_URL` - Already set by deployment script
- `JWT_SECRET_KEY` - Already generated by deployment script
- `CORS_ORIGINS` - Add your domain(s)
- `DEFAULT_ADMIN_PASSWORD` - Change from default
- `DEFAULT_ADMIN_EMAIL` - Use your email

### 2. Install SSL Certificate

```bash
sudo apt-get install certbot python3-certbot-nginx
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
```

### 3. Restart Application

```bash
sudo supervisorctl restart mindlab-health
```

## Essential Commands

### Application Management

```bash
# Start application
sudo supervisorctl start mindlab-health

# Stop application
sudo supervisorctl stop mindlab-health

# Restart application
sudo supervisorctl restart mindlab-health

# Check status
sudo supervisorctl status mindlab-health
```

### View Logs

```bash
# Application logs
sudo tail -f /var/log/mindlab-health/error.log
sudo tail -f /var/log/mindlab-health/access.log

# Nginx logs
sudo tail -f /var/log/nginx/mindlab-health-error.log
sudo tail -f /var/log/nginx/mindlab-health-access.log

# Supervisor logs
sudo supervisorctl tail -f mindlab-health stderr
```

### Database Operations

```bash
# Connect to database
psql -U mindlab_user -d mindlab_health_production

# Manual backup
sudo -u mindlab pg_dump -U mindlab_user mindlab_health_production > backup.sql

# Restore from backup
sudo -u mindlab psql -U mindlab_user mindlab_health_production < backup.sql
```

### Update Application

```bash
# SSH into VPS
ssh root@your-vps-ip

# Switch to app directory
cd /var/www/mindlab-health/app

# Pull latest changes
sudo -u mindlab git pull origin master

# Update dependencies
sudo -u mindlab venv/bin/pip install -r requirements.txt --upgrade

# Restart application
sudo supervisorctl restart mindlab-health
```

## Security Checklist

- [ ] Changed `DEFAULT_ADMIN_PASSWORD` in .env
- [ ] Generated secure `JWT_SECRET_KEY` (done by script)
- [ ] Set strong database password (done by script)
- [ ] Updated `CORS_ORIGINS` with your domain
- [ ] Installed SSL certificate
- [ ] Configured firewall (done by script)
- [ ] Set up automated backups (done by script)
- [ ] Removed .env from git tracking (already done)

## Performance Settings

Edit `/var/www/mindlab-health/app/gunicorn_config.py`:

```python
# Adjust workers based on VPS resources
# Formula: (2 x CPU cores) + 1
workers = 4  # For 2-core VPS

# Adjust timeout for long-running requests
timeout = 120  # seconds
```

## Monitoring

### Check System Resources

```bash
# CPU and memory usage
htop

# Disk usage
df -h

# Check application process
ps aux | grep gunicorn
```

### Check Application Health

```bash
# Test API endpoint
curl http://localhost:8000/api/health

# Test from outside
curl https://yourdomain.com/api/health
```

## Troubleshooting

### Application Won't Start

```bash
# Check supervisor logs
sudo supervisorctl tail -f mindlab-health stderr

# Check if port 8000 is in use
sudo netstat -tlnp | grep 8000

# Restart supervisor
sudo systemctl restart supervisor
```

### Database Connection Errors

```bash
# Check PostgreSQL status
sudo systemctl status postgresql

# Check if database exists
sudo -u postgres psql -l | grep mindlab

# Verify .env DATABASE_URL is correct
cat /var/www/mindlab-health/app/.env | grep DATABASE_URL
```

### 502 Bad Gateway (Nginx)

```bash
# Check if Gunicorn is running
sudo supervisorctl status mindlab-health

# Test Nginx configuration
sudo nginx -t

# Restart Nginx
sudo systemctl restart nginx
```

### Permission Errors

```bash
# Fix ownership
sudo chown -R mindlab:mindlab /var/www/mindlab-health
sudo chown -R mindlab:mindlab /var/log/mindlab-health

# Fix .env permissions
sudo chmod 600 /var/www/mindlab-health/app/.env
```

## Environment Variables Reference

### Required Settings

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URL` | PostgreSQL connection | `postgresql://user:pass@localhost:5432/db` |
| `JWT_SECRET_KEY` | Secret for JWT tokens | Use `openssl rand -hex 32` |
| `CORS_ORIGINS` | Allowed domains | `https://yourdomain.com` |

### Optional Settings

| Variable | Description | Default |
|----------|-------------|---------|
| `PORT` | Application port | `8000` |
| `WORKERS` | Gunicorn workers | `4` |
| `DEBUG` | Debug mode | `False` |
| `LOG_LEVEL` | Logging level | `INFO` |

## Backup & Recovery

### Automated Backups

Backups run daily at 2 AM via cron:
```bash
# View backup schedule
crontab -u mindlab -l

# Manual backup
sudo -u mindlab /var/www/mindlab-health/app/backup_database.sh

# List backups
ls -lh /var/backups/mindlab-health/
```

### Restore Process

```bash
# Stop application
sudo supervisorctl stop mindlab-health

# Restore database
gunzip < /var/backups/mindlab-health/backup_YYYYMMDD_HHMMSS.sql.gz | \
  psql -U mindlab_user -d mindlab_health_production

# Start application
sudo supervisorctl start mindlab-health
```

## Getting Help

1. **Check logs first**: Most issues are logged in error.log
2. **Verify configuration**: Ensure .env settings are correct
3. **Test components individually**: Database, Nginx, Gunicorn
4. **Review deployment guide**: DEPLOYMENT_HOSTINGER.md

## Useful Links

- **GitHub Repository**: https://github.com/onefsmedia/mindlab-health-v2
- **FastAPI Docs**: https://fastapi.tiangolo.com/
- **Gunicorn Docs**: https://docs.gunicorn.org/
- **Nginx Docs**: https://nginx.org/en/docs/

## Production URLs

After deployment, your application will be available at:
- **Frontend**: https://yourdomain.com
- **API Docs**: https://yourdomain.com/docs
- **API**: https://yourdomain.com/api/

## Next Steps After Deployment

1. ✅ Test application is running
2. ✅ Login with admin credentials
3. ✅ Change admin password
4. ✅ Configure Google Calendar (if needed)
5. ✅ Set up monitoring/alerts
6. ✅ Configure email notifications (optional)
7. ✅ Test backup/restore process
8. ✅ Document any custom configurations

---

**Support**: For deployment issues, check the logs or review DEPLOYMENT_HOSTINGER.md
